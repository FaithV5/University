<!-- templates/students.html -->
{% extends "layout.html" %}
{% block content %}
<div class="d-flex justify-content-between mb-3">
    <h3>Students</h3>
    <div>
        <a class="btn btn-success" href="{{ url_for('add_student') }}">Add Student</a>
        <a class="btn btn-outline-primary" href="{{ url_for('export_students', dept=selected_dept) }}">Export to Excel</a>
    </div>
</div>

<form method="get" class="row g-2 mb-3">
    <div class="col-md-3">
        <select name="dept" class="form-select" onchange="this.form.submit()">
        <option value="">All Departments</option>
        {% for d in departments %}
        <option value="{{ d.code }}" {% if selected_dept==d.code %}selected{% endif %}>{{ d.code }}</option>
        {% endfor %}
        </select>
    </div>
    <div class="col-md-3">
        <select name="program" class="form-select" onchange="this.form.submit()">
        <option value="">All Programs</option>
        {% for p in programs %}
        <option value="{{ p.id }}"{% if selected_program == p.id|string %}selected{% endif %}>{{ p.name|truncate(40) }}</option>
        {% endfor %}
        </select>
    </div>
    <div class="col-md-3">
        <select name="course" class="form-select" onchange="this.form.submit()">
        <option value="">All Courses</option>
        {% for c in courses %}
        <option value="{{ c.id }}" {% if selected_course == c.id|string %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
        </select>
    </div>
</form>

<div class="table-responsive">
    <table class="table table-striped">
        <thead class="table-light">
        <tr>
            <th>Student ID</th><th>Name</th><th>Department</th><th>Program</th><th>Course</th><th>Semester</th><th>Grade</th><th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for s in students %}
        <tr>
            <td>{{ s.student_id }}</td>
            <td>{{ s.name }}</td>
            <td>{{ s.dept_code }}</td>
            <td>{{ s.program_name or '-' }}</td>
            <td>{{ s.course_name or '-' }}</td>
            <td>{{ s.semester }}</td>
            <td>{{ s.grade or '-' }}</td>
            <td>
            <a class="btn btn-sm btn-primary" href="{{ url_for('edit_student', id=s.id) }}">Edit</a>
            <form style="display:inline" method="post" action="{{ url_for('delete_student', id=s.id) }}" onsubmit="return confirm('Delete student?');">
                <button class="btn btn-sm btn-danger">Delete</button>
            </form>
            </td>
        </tr>
        {% endfor %}
        {% if students|length == 0 %}
        <tr><td colspan="7" class="text-center">No students yet</td></tr>
        {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}